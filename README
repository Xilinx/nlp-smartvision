/******************************************************************************
* Copyright (C) 2010 - 2021 Xilinx, Inc. All rights reserved.
* SPDX-License-Identifier: Apache-2.0
******************************************************************************/

0. Development Guide:
   If you want to build from source, follow these steps, otherwise skip this section.

   1) Install the SoM sdk.sh to the path you choose or default. Suppose SDKPATH.
   2) Run "./build.sh ${SDKPATH}" to build the somapp application.
   3) The build process in 2) will produce a rpm package kws_aa-1.0.1-1.aarch64.rpm under build/, upload to the board,
      and run "rpm -ivh --force ./kws_aa-1.0.1-1.aarch64.rpm" to update install.

The following file outlines the file structure and instructions on how to use
the kws application. This file outlines the HW requirements for the application,
how to run the application, and an overview of the application file structure. 

1. How to run the example application:
    A) Hardware and software set-up:
       a) Monitor:
          Before booting, connect the monitor to the board via DP port.
       b) IAS sensor:
          Before power on, install a AR1335 sensor module in J7.
       c) UART/JTAG interface:
          For interacting and seeing boot time information connect a USB debugger to the J4.
       d) Connect USB microphone to one of the usb ports
       e) Network connection:
          Connect the Ethernet cable to your local network with DHCP enabled or a direct PC connection
          with a static IP configuration.
       
    B) The accelerated application (AA) firmware consiting of bitstream, device tree overlay (dtbo), and xclbin
       file are loaded dynamically on user request once Linux is fully booted. The xmutil utility can be used
       for that purpose.

       a) To list the available AA applications, run:

            xmutil listapps

          You should see similar output to this:

            Accelerator,     Type,   Active
            kv260-aa2,       flat,   0
            kv260-aa1,       flat,   0
            kv260-aa7,       flat,   0

          The Active column shows which AA is currently loaded in the system. It will change to 1 after the
          firmware is loaded.

       b) To load the AA7 application firmware consisting of PL bitstream, device tree overlay and xclbin,
          run the following command:

            xmutil loadapp kv260-aa7

       c) After you are done running the application, you can unload the curently loaded AA application
          firmware by running:

            xmutil unloadapp

    C) Two methods of interacting with the application are provided.
       Before running any of the two, execute /opt/xilinx/bin/rgb_mipi-dp.sh, it will initialize all the IPs and starts running MIPI-DP pipeline at 1920x1080/30FPS. 
      
       a) A Juypter notebook. Use a web-browser (e.g. Chrome, Firefox) to interact with the platform.
          i) The Jupyter notebook URL will be printed to the UART if the board is connected and allocated an IP address at boot. 
                Example: http://<board_ip_addr>:8888
          ii) If using a direct connection (no DHCP) see public documentation on how to configure your PC with a static IP on the same subnet. 
              For the SOM target set the desired IP address within the same subnet using ifconfig.
                Example: ifconfig eth0 10.0.1.15 netmask 255.255.255.0
              The notebook will be available at http://<your defined IP addr>:8888
       
       b) Command line application (kws_aa). This is to be executed using the UART/debug interface. Execute the application. it will print the below task-keywork pair table and starts running facedetect. 
       based on input from microphone, it will print the detected keyword and will switch to corresponding action.
            ----------------------------------------------------------------
                                    Task            :       Keyword
            ----------------------------------------------------------------
             No Bounding Boxes                      :       NO
             Display Bounding Boxes                 :       YES
             Monitor display OFF                    :       OFF
             Monitor display ON                     :       ON
             Increase Bounding Box Thickness        :       UP
             Decrease Bounding Box Thickness        :       DOWN
             Show faces only in LEFT of the screen  :       LEFT
             Show faces only in RIGHT of the screen :       RIGHT
             STOP quadrant wise display of faces    :       STOP
             Switch the colors of box (R-> G-> B)   :       GO
            ----------------------------------------------------------------
      Note: if you get "audio open error: No such file or directory" error, run "aplay -l" and note the number assigned to USB microphone. open /etc/asound.conf and edit card number to the one assigned to USB microphone

3. File structure:
    The application is installed as:
        Binary File: => /usr/bin
                                        kws_aa         main app

        Script File: => /opt/xilinx/bin/
                                        rgb_mipi-dp.sh        Initialized all media IPs and starts running RGB MIPI-DP pipeline at 1920x1080/30FPS
                                       

    Jupyter notebook file:  => /usr/share/notebooks/kws_aa
                                        kws_aa.ipynb              Jupyter notebook file for running demo.

